Perfect âœ… Hereâ€™s the enhanced version of your .bat script â€” it automatically names the Excel file with todayâ€™s date (e.g. result_2025-10-29.xlsx).


---

ðŸ§¾ extract_to_excel.bat

@echo off
setlocal enabledelayedexpansion

:: === Input and output files ===
set "input=data.txt"
set "csv=data.csv"

:: === Generate date string (YYYY-MM-DD) ===
for /f "tokens=2-4 delims=/.- " %%a in ('date /t') do (
    set "day=%%a"
    set "month=%%b"
    set "year=%%c"
)
:: Handle different regional formats (if day is 2025 for example)
if "%year%"=="" (
    for /f "tokens=1-3 delims=/.- " %%a in ('date /t') do (
        set "year=%%a"
        set "month=%%b"
        set "day=%%c"
    )
)
set "today=%year%-%month%-%day%"
set "xlsx=result_%today%.xlsx"

if not exist "%input%" (
    echo Input file "%input%" not found.
    pause
    exit /b
)

echo Name,RIP,Montant > "%csv%"

:: === Read and extract fields by position ===
for /f "usebackq delims=" %%A in ("%input%") do (
    set "line=%%A"
    set "name=!line:~0,14!"
    set "rip=!line:~16,27!"
    set "montant=!line:~44,21!"

    :: Trim spaces
    for /f "tokens=* delims= " %%n in ("!name!") do set "name=%%n"
    for /f "tokens=* delims= " %%r in ("!rip!") do set "rip=%%r"
    for /f "tokens=* delims= " %%m in ("!montant!") do set "montant=%%m"

    :: Ignore if RIP is empty
    if not "!rip!"=="" (
        echo !name!,!rip!,!montant! >> "%csv%"
    )
)

echo CSV created: "%csv%"
echo Converting to Excel: "%xlsx%" ...

:: === Convert CSV to Excel (.xlsx) using PowerShell ===
powershell -command ^
    "$excel = New-Object -ComObject Excel.Application; " ^
    "$excel.Visible = $false; " ^
    "$wb = $excel.Workbooks.Open((Resolve-Path '%cd%\%csv%')); " ^
    "$wb.SaveAs((Resolve-Path '%cd%\%xlsx%'), 51); " ^
    "$wb.Close($false); " ^
    "$excel.Quit();"

echo Done! Excel file saved as "%xlsx%"
pause


---

âœ… Example output
Perfect â€” I see exactly whatâ€™s happening here ðŸ‘‡

The problem is the path contains spaces (OneDrive - BNP Paribas), and your PowerShell command doesnâ€™t quote paths correctly.
In a batch file, when passing quoted strings into PowerShell, you need escaped quotes (\") inside the PowerShell command.

Letâ€™s fix your .bat file step by step âœ…


---

âœ… Corrected Batch Script

@echo off
setlocal

:: Define file names
set "csv=data.csv"
set "xlsx=result_%date:~0,2%-%date:~3,2%-%date:~6,4%.xlsx"

echo CSV created: "%csv%"
echo Converting to Excel: "%xlsx%"

::=== Convert CSV to Excel (.xlsx) using PowerShell ===
powershell -NoProfile -Command ^
  "$excel = New-Object -ComObject Excel.Application; " ^
  "$excel.Visible = $false; " ^
  "$csvPath = Resolve-Path \"%cd%\%csv%\"; " ^
  "$xlsxPath = Join-Path (Get-Location) \"%xlsx%\"; " ^
  "$wb = $excel.Workbooks.Open($csvPath); " ^
  "$wb.SaveAs($xlsxPath, 51); " ^
  "$wb.Close($false); " ^
  "$excel.Quit();"

echo Done.
pause


---

ðŸ§  Key Fixes Explained

1. Proper PowerShell call:
powershell -NoProfile -Command is the correct syntax â€” not powershell-command.


2. Quoted paths:
I wrapped the file paths in escaped quotes (\") to handle spaces correctly ("OneDrive - BNP Paribas").


3. Using Join-Path:
Safer than Resolve-Path for non-existent output files.


4. 51 Excel format:
This is the correct code for .xlsx output (Excel Open XML Workbook).


5. Added pause:
So you can read the console output before it closes.




---

âœ… Example Output

CSV created: "data.csv"
Converting to Excel: "result_02-11-2025.xlsx"
Done.
Press any key to continue . . .


---

Would you like me to make it automatically check if Excel is installed and show a friendly message if not? (Useful for deployment.)
If today is October 29, 2025, the file will be named:

result_2025-10-29.xlsx


---

Would you like me to make it automatically delete the temporary data.csv after generating the Excel file (to keep the folder clean)?
###$$$$$$
$$____
Excellent â€” thatâ€™s real progress ðŸ‘
If thereâ€™s no .xlsx file generated even though the command ran without an error, it usually means Excel opened the CSV but didnâ€™t save properly (often due to path or permissions).

Letâ€™s fix this precisely ðŸ‘‡


---

âœ… Improved and Reliable Version

This one ensures the file is saved in the same folder as your .bat file.

@echo off
setlocal

::=== Define current directory ===
set "workdir=%~dp0"

::=== Define file names ===
set "csv=%workdir%data.csv"
set "xlsx=%workdir%result_%date:~0,2%-%date:~3,2%-%date:~6,4%.xlsx"

echo CSV created: "%csv%"
echo Converting to Excel: "%xlsx%"

::=== Convert CSV to Excel (.xlsx) using PowerShell ===
powershell -NoProfile -Command ^
  "$excel = New-Object -ComObject Excel.Application; " ^
  "$excel.Visible = $false; " ^
  "$csvPath = '%csv%'; " ^
  "$xlsxPath = '%xlsx%'; " ^
  "Write-Host 'Opening:' $csvPath; " ^
  "$wb = $excel.Workbooks.Open($csvPath); " ^
  "Write-Host 'Saving as:' $xlsxPath; " ^
  "$wb.SaveAs($xlsxPath, 51); " ^
  "$wb.Close($false); " ^
  "$excel.Quit(); " ^
  "Write-Host 'Conversion complete.'"

echo Done.
pause


---

ðŸ” Key Improvements

%~dp0 ensures paths point to the folder containing your .bat file, not where CMD is launched from.

No Resolve-Path â€” because the output file doesnâ€™t exist yet, and that causes issues.

Debug messages show what paths Excel is actually using.



---

ðŸ§ª Test checklist

1. Put your .bat file and data.csv in the same folder.


2. Run the .bat file by double-clicking it (not from a different path).


3. Watch the PowerShell output â€” you should see:

Opening: C:\Users\h34667\OneDrive - BNP Paribas\Documents\test\data.csv
Saving as: C:\Users\h34667\OneDrive - BNP Paribas\Documents\test\result_02-11-2025.xlsx
Conversion complete.


4. After it says Done, check the same folder for your .xlsx.




---

If it still doesnâ€™t appear, please tell me what the PowerShell lines say (those that start with â€œOpening:â€ and â€œSaving as:â€), and Iâ€™ll pinpoint the exact cause.

Would you like me to make it overwrite the file automatically if it already exists (instead of Excel prompting silently)?
#############$#

Perfect ðŸ‘ thanks for confirming â€” youâ€™re running it from CMD, not by double-clicking the .bat.

Thatâ€™s an important detail because when you run from CMD, %cd% is the current directory, not necessarily where the .bat file is.
If you want the .xlsx to always appear in the same folder as the .bat, even when you launch it from another path, you should use %~dp0 (the batch variable for â€œdirectory of this scriptâ€).

Hereâ€™s the exact version that will work perfectly in CMD ðŸ‘‡


---

âœ… Final CMD-Safe Batch Script

@echo off
setlocal

::=== Always work in the folder where this script is ===
cd /d "%~dp0"

::=== Define file names ===
set "csv=data.csv"
set "xlsx=result_%date:~0,2%-%date:~3,2%-%date:~6,4%.xlsx"

echo CSV created: "%cd%\%csv%"
echo Converting to Excel: "%cd%\%xlsx%"

::=== Convert CSV to Excel (.xlsx) using PowerShell ===
powershell -NoProfile -Command ^
  "$excel = New-Object -ComObject Excel.Application; " ^
  "$excel.Visible = $false; " ^
  "$csvPath = '%cd%\%csv%'; " ^
  "$xlsxPath = '%cd%\%xlsx%'; " ^
  "Write-Host 'Opening:' $csvPath; " ^
  "$wb = $excel.Workbooks.Open($csvPath); " ^
  "Write-Host 'Saving as:' $xlsxPath; " ^
  "$wb.SaveAs($xlsxPath, 51); " ^
  "$wb.Close($false); " ^
  "$excel.Quit(); " ^
  "Write-Host 'Conversion complete.'"

echo Done.
pause


---

ðŸ§­ How to run it correctly

1. Open CMD anywhere (for example, C:\Users\h34667>).


2. Navigate to your script folder, or just run the .bat by full path, e.g.:

"C:\Users\h34667\OneDrive - BNP Paribas\Documents\test\data_pro.bat"


3. Youâ€™ll see messages like:

Opening: C:\Users\h34667\OneDrive - BNP Paribas\Documents\test\data.csv
Saving as: C:\Users\h34667\OneDrive - BNP Paribas\Documents\test\result_02-11-2025.xlsx
Conversion complete.


4. The Excel file should appear in the same folder as your .bat and .csv.




---

If you still donâ€™t see the .xlsx, please copy-paste what appears in CMD after the lines:

Opening: ...
Saving as: ...

Thatâ€™ll let me pinpoint the final missing step (it could be permissions, Excel version, or OneDrive sync timing).
_______________________________________________________________________
@echo off
setlocal enabledelayedexpansion

set "input=VIR_A_IMPORT.txt"
set "output=data.csv"

if not exist "%input%" (
    echo âŒ Input file "%input%" not found!
    pause
    exit /b
)

if exist "%output%" del "%output%"

echo Numero Du Compte Donneur ordre;Code Swift De La Banque Donneuse order;Nom De la Contrepartie;Numero De Compte De La Contrepartie;Pays Ou Emplacement de la Contrepartie;Pays Ou Emplacement de la banque de la Contrepartie;Devise De instruction;Information De La Remise;Banque > "%output%"

set "Compte=0270078000016380011"
set "Swift=BNPDZALXXX"
set "Pays=DZ"
set "Devise=DZD"
set "Info=Mutuelle Cardif"

rem Count total lines
set /a count=0
for /f "usebackq delims=" %%A in ("%input%") do (
    set /a count+=1
    echo %%A>>temp.txt
)

set /a total=%count%
set /a current=0

rem Process lines except first and last
for /f "usebackq delims=" %%A in ("temp.txt") do (
    set /a current+=1
    if !current! gtr 1 if !current! lss %total% (
        set "line=%%A"

        rem Extract substrings (fixed positions)
        set "Nom=!line:~0,14!"
        set "Rip=!line:~16,27!"
        set "Montant=!line:~44,21!"
        set "Code=!line:~53,4!"
        set "NomContrepartie=!line:~30,24!"
        set "CompteContrepartie=!line:~55,20!"
        set "MontantInstruction=!line:~103,13!"
        set "Banque="

        if "!Code!"=="027" set "Banque=BNP ED"
        if "!Code!"=="911" set "Banque=CNEP"

        >>"%output%" echo %Compte%;%Swift%;!NomContrepartie!;!CompteContrepartie!;%Pays%;%Pays%;%Devise%;%Info%;!Banque!
    )
)

del temp.txt

echo ----------------------------------------
echo âœ… Extraction completed successfully!
echo File created: %output%
echo ----------------------------------------
pause

